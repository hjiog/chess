import{S as t,b as s,i as e}from"./utils.9dc632db.js";import"./vendor.8141013a.js";const o=[];function n(t){const{originPostion:s,currentPostion:e,back:n,chessboardMap:i}=t,r=i[s.top][s.left],a=i[e.top][e.left];if(i[e.top][e.left]=r,n){const t=o.pop();i[s.top][s.left]=t||0}else o.push(a),i[s.top][s.left]=0}const i=(t,e)=>e?t&s.red:t&s.black,r=(o,n)=>{const r=t.isPlayFirst?!o:o;return-1!==n.findIndex(((t,o)=>-1!==t.findIndex(((t,a)=>{if(i(t,r)){return-1!==e[t].getAllMovePosition({top:o,left:a,chessType:t,ChessBoardMap:n}).findIndex((([t,e])=>n[t][e]&s.j))}return!1}))))},a=new WeakMap;function c(t){return a.has(t)?a.get(t):0}function l(t,s){if(a.has(t)){const e=a.get(t)+s*s;a.set(t,e)}else a.set(t,s*s)}const h=[0,1,4,13,40,121,364,1093];class f{constructor(s,o){this.mvs=[],this.vls=[],this.index=0;const n=function(t,s){let o=[];return s.forEach(((n,r)=>{n.forEach(((n,a)=>{if(i(n,t)){const t=e[n].getAllMovePosition({top:r,left:a,chessType:n,ChessBoardMap:s});o=o.concat(t.map((t=>({originPostion:{top:r,left:a},currentPostion:{top:t[0],left:t[1]}}))))}}))})),o}(t.isPlayFirst?!s:s,o);for(let t=0;t<n.length;t++){const s=n[t];this.mvs.push(s),this.vls.push(c(s))}!function(t,s){let e=1;for(;h[e]<t.length;)e++;e--;for(;e>0;){const o=h[e];for(let e=o;e<t.length;e++){const n=t[e],i=s[e];let r=e-o;for(;r>=0&&i>s[r];)t[r+o]=t[r],s[r+o]=s[r],r-=o;t[r+o]=n,s[r+o]=i}e--}}(this.mvs,this.vls)}next(){if(this.index<this.mvs.length){const t=this.mvs[this.index];return this.index++,t}}}function p(o){const{depth:i,chessboardMap:a,searchResult:c}=o;let{valAlpha:h,valBeta:u}=o;const d=0==(1&i);if(0===i)return function(o){let n=0;return t.isPlayFirst?o.forEach(((t,o)=>{t.forEach(((t,i)=>{t&s.red?n-=e[t].valueMap[o][i]:t&s.black&&(n+=e[t].valueMap[o][i])}))})):o.forEach(((t,o)=>{t.forEach(((t,i)=>{t&s.red?n+=e[t].valueMap[o][i]:t&s.black&&(n-=e[t].valueMap[o][i])}))})),n}(a);const v=new f(d,a);let P=0,g=!1;for(let t=v.next();t;t=v.next()){const{originPostion:e,currentPostion:o}=t;if(a[o.top][o.left]&s.j)return d?99999:-99999;if(n({originPostion:e,currentPostion:o,back:!1,chessboardMap:a}),g=r(d,a),g)n({originPostion:o,currentPostion:e,back:!0,chessboardMap:a});else if(P=p({valAlpha:h,valBeta:u,depth:i-1,chessboardMap:a,searchResult:c}),n({originPostion:o,currentPostion:e,back:!0,chessboardMap:a}),d){if(P>h&&(h=P,4===i&&(c.currentPostion=o,c.originPostion=e),h>=u))return l(t,i),u}else if(P<u&&(u=P,h>=u))return l(t,i),h}return d?h:u}const u=self;u.addEventListener("message",(s=>{console.log("ai start,recieve data:",s.data),t.isPlayFirst=s.data.isPlayFirst;const e={originPostion:{top:0,left:0},currentPostion:{top:0,left:0}},o=p({valAlpha:-99999,valBeta:99999,depth:4,chessboardMap:s.data.ChessBoardMap,searchResult:e});console.log(e,"value:",o),u.postMessage(e)}));
